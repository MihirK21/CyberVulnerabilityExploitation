 <#

.SYNOPSIS
    Ransomware Script using AES to recursively decrypt files at a given folder path.

.DESCRIPTION
    This script is intended to be used to attack a system in a controlled environment and decrypt all files with a decryption key.

.EXAMPLE
    .\RanSim.ps1 -mode encrypt -targetpath "C:\Mihir"

.PARAMETER File Extension
    This optional parameter defines the extension that will be added to the encrypted files once attacked. A default extension is provided.

.PARAMETER Encryption key
    This parameter is the plain-text AES encryption key used for both encryption and decryption. A default key is provided. 

.Types of files checked
    "*.pdf','*.xls*','*.ppt*','*.doc*','*.accd*','*.rtf','*.txt','*.csv','*.jpg','*.jpeg','*.png','*.gif','*.avi','*.midi','*.mov','*.mp3','*.mp4','*.mpeg','*.mpeg2','*.mpeg3','*.mpg','*.ogg"

.NOTES
    This script uses the FileCryptopgraphy module from Tyler Siegrist - https://gallery.technet.microsoft.com/scriptcenter/EncryptDecrypt-files-use-65e7ae5d

#>

# Define parameters and their defaults
param([string]$Mode,
      [string]$TargetPath = "C:\EnterYourPathNAme",
      [string]$Extension = ".locked",
      [string]$Key = ""
)

# Define target file types
$TargetFiles = '*.pdf','*.xls*','*.ppt*','*.doc*','*.accd*','*.rtf','*.txt','*.csv','*.jpg','*.jpeg','*.png','*.gif','*.avi','*.midi','*.mov','*.mp3','*.mp4','*.mpeg','*.mpeg2','*.mpeg3','*.mpg','*.ogg'

# Import FileCryptography module
Import-Module "$PSScriptRoot\FileCryptography.psm1"

if ($mode -eq "decrypt") {
    # Gather all files from the target path and its subdirectories
    $FilestoDecrypt = get-childitem -path $TargetPath\* -Include *$Extension -Recurse -force | where { ! $_.PSIsContainer }

    # Encrypt the files
    foreach ($file in $FilestoDecrypt)
    {
        Write-Host "Decrypting $file"
        Unprotect-File $file -Algorithm AES -KeyAsPlainText $key -Suffix $Extension  -RemoveSource
    }
}

else {
    write-host "ERROR: must choose a mode (encrypt or decrypt). Example usage: .\DecryptFiles.ps1 -mode decrypt"
}
exit 
